{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "M3C2 Pipeline Configuration",
  "type": "object",
  "additionalProperties": false,

  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional JSON Schema reference for editor validation"
    },

    "logging": {
      "type": "object",
      "title": "Logging Settings",
      "additionalProperties": false,
      "properties": {
        "level": {
          "type": "string",
          "description": "Logging level.",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"],
          "default": "INFO"
        },
        "file": {
          "type": "string",
          "description": "File path for log output.",
          "default": "logs/orchestration.log"
        },
        "format": {
          "type": "string",
          "description": "Format string for log messages.",
          "default": "%(asctime)s [%(levelname)-8s] %(name)s - %(message)s"
        },
        "date_format": {
          "type": "string",
          "description": "Datetime format for log messages.",
          "default": "%Y-%m-%d %H:%M:%S"
        }
      },
      "required": ["level", "file", "format", "date_format"]
    },

    "arguments": {
      "type": "object",
      "title": "Pipeline Arguments",
      "additionalProperties": false,
      "properties": {
        "data_dir": {
          "type": "string",
          "description": "Input directory containing folders with point clouds.",
          "default": "data"
        },
        "folders": {
          "type": "array",
          "description": "List of folders containing point clouds (comma-separated in GUI).",
          "items": { "type": "string" },
          "default": ["pointclouds"]
        },
        "filename_reference": {
          "type": "string",
          "description": "Reference point cloud filename for distance calculation (unused for single-cloud statistics).",
          "default": ""
        },
        "filename_comparison": {
          "type": "string",
          "description": "Comparison point cloud filename for distance calculation (unused for single-cloud statistics).",
          "default": ""
        },
        "filename_singlecloud": {
          "type": "string",
          "description": "Single point cloud filename used for single-cloud statistics.",
          "default": ""
        },
        "use_subsampled_corepoints": {
          "type": "integer",
          "description": "Use subsampled core points for distance computation. Eg. 3: Every 3rd point is used for the subsample.",
          "minimum": 1,
          "default": 1
        },
        "sample_size": {
          "type": "integer",
          "description": "Number of core points used for parameter estimation (normal & projection scale). Not used to subsample distances.",
          "minimum": 1,
          "default": 10000
        },
        "scale_strategy": {
          "type": "string",
          "description": "Strategy used for parameter estimation (currently only 'radius' is supported).",
          "enum": ["radius"],
          "default": "radius"
        },
        "only_stats": {
          "type": "boolean",
          "description": "If true, compute only statistics (no parameter estimation or M3C2 distance calculation).",
          "default": true
        },
        "stats_singleordistance": {
          "type": "string",
          "description": "Statistics type: 'single' for single-cloud statistics or 'distance' for pairwise distance analysis.",
          "enum": ["single", "distance"],
          "default": "single"
        },
        "output_format": {
          "type": "string",
          "description": "Output format for results.",
          "enum": ["excel", "json"],
          "default": "excel"
        },
        "project": {
          "type": "string",
          "description": "Project name used as prefix for folders and output files.",
          "default": "PROJECT"
        },
        "normal_override": {
          "type": ["number", "null"],
          "description": "Manual override for normal scale instead of automatic estimation.",
          "default": null,
          "minimum": 0
        },
        "proj_override": {
          "type": ["number", "null"],
          "description": "Manual override for projection scale instead of automatic estimation.",
          "default": null,
          "minimum": 0
        },
        "use_existing_params": {
          "type": "boolean",
          "description": "If true, use existing parameter file instead of recalculating.",
          "default": false
        },
        "outlier_detection_method": {
          "type": "string",
          "description": "Method for outlier detection.",
          "enum": ["rmse", "mad", "nmad", "std"],
          "default": "rmse"
        },
        "outlier_multiplicator": {
          "type": "number",
          "description": "Multiplicator applied by the chosen outlier method.",
          "minimum": 0,
          "default": 3.0
        }
      },
      "required": [
        "data_dir",
        "folders",
        "filename_reference",
        "filename_comparison",
        "filename_singlecloud",
        "use_subsampled_corepoints",
        "sample_size",
        "scale_strategy",
        "only_stats",
        "stats_singleordistance",
        "output_format",
        "project",
        "normal_override",
        "proj_override",
        "use_existing_params",
        "outlier_detection_method",
        "outlier_multiplicator"
      ]
    },

    "arguments_plot_specific_files": {
      "type": "object",
      "title": "Plotting Arguments",
      "additionalProperties": false,
      "properties": {
        "overlay_outdir": {
          "type": "string",
          "description": "Output directory for plots.",
          "default": "output/plots"
        },
        "overlay_files": {
          "type": "array",
          "description": "List of distance.txt files for overlay plots.",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "plot_types": {
          "type": "array",
          "description": "Types of plots to generate (comma-separated in GUI).",
          "items": { 
            "type": "string",
            "enum": ["histogram", "boxplot", "scatter", "heatmap"]
          },
          "default": ["histogram", "boxplot", "scatter", "heatmap"]
        }
      },
      "required": [
        "overlay_outdir",
        "overlay_files",
        "plot_types"
      ]
    },

    "arguments_plot_files_in_folder": {
      "type": "object",
      "title": "Plotting Arguments for All Files in a Folder",
      "additionalProperties": false,
      "properties": {
        "folder": {
          "type": "string",
          "description": "Input folder containing distance.txt files for overlay plots.",
          "default": "data/pointclouds"
        },
        "overlay_outdir": {
          "type": "string",
          "description": "Output directory for plots.",
          "default": "output/plots"
        },
        "options": {
          "type": "array",
          "description": "Types of plots to generate (comma-separated in GUI).",
          "items": { 
            "type": "string",
            "enum": ["plot_hist", "plot_gauss", "plot_weibull", "plot_box", "plot_qq", "plot_grouped_bar"]
          },
          "default": ["plot_hist", "plot_gauss", "plot_weibull", "plot_box", "plot_qq", "plot_grouped_bar"]
        }
      },
      "required": [
        "folder",
        "overlay_outdir",
        "options"
      ]
    }
  },

  "required": ["logging", "arguments"],

  "examples": [
    {
      "logging": {
        "level": "INFO",
        "file": "logs/orchestration.log",
        "format": "%(asctime)s [%(levelname)-8s] %(name)s - %(message)s",
        "date_format": "%Y-%m-%d %H:%M:%S"
      },
      "arguments": {
        "data_dir": "data",
        "folders": ["cloudfolder"],
        "filename_reference": "cloud_i_want_to_compare",
        "filename_comparison": "second_cloud_to_compare",
        "filename_singlecloud": "If_I_only_want_cloud_stats",
        "use_subsampled_corepoints": 1,
        "sample_size": 10000,
        "scale_strategy": "radius",
        "only_stats": true,
        "stats_singleordistance": "single",
        "output_format": "excel",
        "project": "TUNSPEKT",
        "normal_override": null,
        "proj_override": null,
        "use_existing_params": false,
        "outlier_detection_method": "rmse",
        "outlier_multiplicator": 3.0
      }
    }
  ]
}
